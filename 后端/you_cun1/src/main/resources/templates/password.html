<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改密码 - 优存科技</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dracula: {
                            bg: '#282a36',
                            current: '#44475a',
                            selection: '#44475a',
                            foreground: '#f8f8f2',
                            comment: '#6272a4',
                            cyan: '#8be9fd',
                            green: '#50fa7b',
                            orange: '#ffb86c',
                            pink: '#ff79c6',
                            purple: '#bd93f9',
                            red: '#ff5555',
                            yellow: '#f1fa8c'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .glass {
                background: rgba(68, 71, 90, 0.5);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(189, 147, 249, 0.18);
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .animate-float {
                animation: float 6s ease-in-out infinite;
            }
            @keyframes float {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
                100% { transform: translateY(0px); }
            }
        }
    </style>
</head>

<body class="bg-dracula-bg min-h-screen flex items-center justify-center p-4 overflow-hidden">
<div class="fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-dracula-purple/20 rounded-full blur-3xl animate-float"></div>
    <div class="absolute bottom-1/3 right-1/4 w-80 h-80 bg-dracula-cyan/20 rounded-full blur-3xl animate-float" style="animation-delay: 2s;"></div>
    <div class="absolute top-1/2 right-1/3 w-72 h-72 bg-dracula-pink/20 rounded-full blur-3xl animate-float" style="animation-delay: 4s;"></div>
</div>

<div class="glass rounded-2xl shadow-[0_8px_32px_0_rgba(0,0,0,0.37)] w-full max-w-md transition-all duration-300 hover:shadow-[0_8px_40px_0_rgba(189,147,249,0.25)]">
    <div class="p-8">

        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-dracula-purple/20 mb-4">
                <i class="fa fa-key text-2xl text-dracula-purple"></i>
            </div>
            <h2 class="text-[clamp(1.5rem,3vw,2rem)] font-bold text-dracula-foreground text-shadow">
                修改密码
            </h2>
            <p class="text-dracula-comment mt-2">请设置您的新密码</p>
        </div>

        <div id="errorMsg" class="hidden bg-dracula-red/20 border border-dracula-red/30 text-dracula-red p-3 rounded-lg mb-4 transition-all duration-300 transform translate-y-0 opacity-0">
            <i class="fa fa-exclamation-circle mr-2"></i><span id="errorText"></span>
        </div>

        <form id="passwordForm" action="/api/user/forget" method="get" class="space-y-6">
            <input type="hidden" id="mail" name="mail" th:value="${mail}" required>
            <input type="hidden" id="token" name="token" th:value="${token}" required>
            <input type="hidden" id="code" name="code" th:value="${code}" required>

            <div class="space-y-2">
                <label for="newPassword" class="block text-dracula-foreground font-medium flex items-center">
                    <i class="fa fa-lock text-dracula-cyan mr-2"></i>新密码
                </label>
                <div class="relative">
                    <input type="password" id="newPassword" name="newPassword"
                           class="w-full px-4 py-3 bg-dracula-current border border-dracula-purple/30 rounded-lg text-dracula-foreground focus:outline-none focus:ring-2 focus:ring-dracula-purple/50 focus:border-transparent transition-all duration-300"
                           placeholder="请输入新密码" required>
                    <button type="button" id="toggleNewPwd" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-dracula-comment hover:text-dracula-foreground transition-colors">
                        <i class="fa fa-eye-slash"></i>
                    </button>
                </div>
                <p class="text-xs text-dracula-comment">密码长度至少8位，包含字母和数字</p>
            </div>

            <div class="space-y-2">
                <label for="confirmPassword" class="block text-dracula-foreground font-medium flex items-center">
                    <i class="fa fa-lock text-dracula-cyan mr-2"></i>确认新密码
                </label>
                <div class="relative">
                    <input type="password" id="confirmPassword"
                           class="w-full px-4 py-3 bg-dracula-current border border-dracula-purple/30 rounded-lg text-dracula-foreground focus:outline-none focus:ring-2 focus:ring-dracula-purple/50 focus:border-transparent transition-all duration-300"
                           placeholder="请再次输入新密码" required>
                    <button type="button" id="toggleConfirmPwd" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-dracula-comment hover:text-dracula-foreground transition-colors">
                        <i class="fa fa-eye-slash"></i>
                    </button>
                </div>
            </div>

            <button type="submit"
                    class="w-full bg-gradient-to-r from-dracula-purple to-dracula-pink text-dracula-foreground font-medium py-3 px-4 rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-dracula-purple/50 transition-all duration-300 transform hover:-translate-y-1 active:translate-y-0 flex items-center justify-center">
                <span>确认修改</span>
                <i class="fa fa-arrow-right ml-2"></i>
            </button>
        </form>


        <div class="mt-8 text-center">
            <p class="text-dracula-comment text-sm">
                @优存科技 版权所有
            </p>
        </div>
    </div>
</div>

<script>

    document.addEventListener('DOMContentLoaded', function() {
        const mail = document.getElementById('mail').value;
        const token = document.getElementById('token').value;
        const code = document.getElementById('code').value;
        const submitBtn = document.querySelector('button[type="submit"]');

        if (!mail || !token || !code) {
            showError('参数错误，请重新获取修改密码链接');
            submitBtn.disabled = true;
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
            return;
        }

        setupPasswordToggle('toggleNewPwd', 'newPassword');
        setupPasswordToggle('toggleConfirmPwd', 'confirmPassword');
    });


    function setupPasswordToggle(toggleId, inputId) {
        const toggleBtn = document.getElementById(toggleId);
        const input = document.getElementById(inputId);

        toggleBtn.addEventListener('click', function() {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            const icon = toggleBtn.querySelector('i');
            if (type === 'password') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    }

    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (newPassword.length < 8) {
            e.preventDefault();
            showError('密码长度至少8位');
            return;
        }

        if (newPassword !== confirmPassword) {
            e.preventDefault();
            showError('两次输入的密码不一致');
            return;
        }

        if (!/^(?=.*[A-Za-z])(?=.*\d).+$/.test(newPassword)) {
            e.preventDefault();
            showError('密码必须包含字母和数字');
            return;
        }
    });

    function showError(message) {
        const errorMsg = document.getElementById('errorMsg');
        const errorText = document.getElementById('errorText');

        errorText.textContent = message;
        errorMsg.classList.remove('hidden');

        setTimeout(() => {
            errorMsg.classList.remove('translate-y-0', 'opacity-0');
            errorMsg.classList.add('translate-y-2', 'opacity-100');
        }, 10);

        setTimeout(() => {
            errorMsg.classList.remove('translate-y-2', 'opacity-100');
            errorMsg.classList.add('translate-y-0', 'opacity-0');
            setTimeout(() => errorMsg.classList.add('hidden'), 300);
        }, 3000);
    }
</script>
</body>
</html>
